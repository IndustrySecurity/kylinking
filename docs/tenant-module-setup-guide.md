# 租户模块管理设置指南

## 概述

本指南将帮助您设置和使用KylinKing系统的租户模块管理功能。该功能允许超级管理员为不同租户配置不同的功能模块，实现租户间的差异化服务。

## 前置条件

1. 系统已正常部署并运行
2. 数据库已初始化（包含租户模块管理相关表）
3. 系统模块已初始化
4. 拥有超级管理员账户

## 设置步骤

### 1. 登录系统

使用超级管理员账户登录系统：
- 用户名：`admin@kylinking.com`
- 密码：`admin123`

### 2. 访问租户模块管理

1. 登录后，在左侧导航栏中找到 **"平台管理"** 菜单
2. 点击展开后选择 **"模块管理"**
3. 进入租户模块管理页面

### 3. 查看系统统计

页面顶部显示系统统计信息：
- **总租户数**：系统中的租户总数
- **总模块数**：系统中可用的模块总数
- **活跃租户**：已配置模块的租户数量
- **平均模块覆盖率**：所有租户的平均模块启用率

### 4. 选择租户

1. 在 **"选择租户"** 下拉框中选择要配置的租户
2. 如果是新租户，点击 **"初始化模块"** 按钮为租户创建默认模块配置
3. 点击 **"刷新"** 按钮更新租户模块配置

### 5. 配置租户模块

选择租户后，会显示该租户的模块配置表格，包含以下信息：

#### 模块信息
- **模块名称**：模块的显示名称
- **分类**：模块所属的功能分类
- **版本**：模块的当前版本
- **状态**：模块的启用状态和可见性
- **配置时间**：最后配置的时间

#### 配置操作
1. 点击模块行的 **"配置"** 按钮
2. 在弹出的配置抽屉中设置：
   - **启用模块**：控制模块是否启用
   - **模块可见**：控制模块是否在租户界面中显示
   - **自定义配置**：JSON格式的自定义配置参数

### 6. 模块配置说明

#### 核心模块
- 标记为 **"核心"** 的模块是系统必需模块
- 核心模块通常不能被完全禁用
- 包括：生产计划管理、质量控制、库存管理

#### 可选模块
- 设备管理、报表分析等模块可以根据租户需求启用或禁用
- 可以为不同租户提供差异化的功能组合

#### 自定义配置
每个模块都支持JSON格式的自定义配置，例如：

```json
{
  "enable_auto_scheduling": true,
  "planning_horizon_days": 30,
  "capacity_utilization_target": 0.85
}
```

## 系统模块说明

### 1. 生产计划管理（核心模块）
- **功能**：薄膜生产计划的制定、调度和跟踪管理
- **字段**：计划编号、产品名称、计划日期、产量、优先级等
- **配置选项**：自动调度、计划周期、产能利用率目标

### 2. 质量控制（核心模块）
- **功能**：薄膜产品质量检测、控制和追溯管理
- **字段**：质检编号、批次号、检测数据、检测结果等
- **配置选项**：自动采样、质量阈值、SPC控制

### 3. 库存管理（核心模块）
- **功能**：原材料和成品的库存管理、入库出库追踪
- **字段**：物料编码、库存数量、安全库存、仓库位置等
- **配置选项**：自动补货、安全库存天数、条码管理

### 4. 设备管理
- **功能**：生产设备的维护、保养和状态监控管理
- **字段**：设备编号、设备状态、维护记录等
- **配置选项**：预测性维护、维护间隔、IoT监控

### 5. 报表分析
- **功能**：生产、质量、库存等各种报表和数据分析
- **配置选项**：自动报表生成、报表保留期、仪表板功能

## 最佳实践

### 1. 租户配置策略
- **基础版租户**：启用核心模块（生产计划、质量控制、库存管理）
- **标准版租户**：核心模块 + 设备管理
- **高级版租户**：全部模块 + 高级配置选项

### 2. 模块依赖管理
- 注意模块间的依赖关系
- 质量控制模块依赖生产计划管理
- 报表分析依赖多个数据源模块

### 3. 配置管理
- 定期备份租户配置
- 记录配置变更历史
- 测试配置变更的影响

## 故障排除

### 常见问题

**Q: 租户看不到某个模块？**
A: 检查模块的 `is_enabled` 和 `is_visible` 设置

**Q: 模块配置不生效？**
A: 确认配置已保存，并检查JSON格式是否正确

**Q: 无法禁用某个模块？**
A: 核心模块和有依赖关系的模块可能无法禁用

### 调试方法
1. 查看浏览器开发者工具的网络请求
2. 检查后端日志
3. 验证数据库中的配置数据

## API参考

### 获取系统模块列表
```bash
GET /api/admin/modules/
```

### 获取租户模块配置
```bash
GET /api/admin/modules/tenants/{tenant_id}/modules
```

### 配置租户模块
```bash
POST /api/admin/modules/tenants/{tenant_id}/modules/{module_id}/configure
```

### 初始化租户模块
```bash
POST /api/admin/modules/tenants/{tenant_id}/initialize
```

## 联系支持

如果在使用过程中遇到问题，请联系技术支持团队。 